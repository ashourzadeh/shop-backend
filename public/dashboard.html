<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙØ±ÙˆØ´</title>
  <link rel="icon" href="ico/favicon.ico" type="image/x-icon">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#000000">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link href="style/style.css" rel="stylesheet">
<!-- Ø¯Ø± head -->
<link rel="stylesheet" href="assets/css/menu.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body { background: #f5f9f6;}
	h1.text-success.mb-4 {margin-top: 20px;}
    .card { margin-bottom: 20px; border: 1px solid #198754; }
    .chart-container { position: relative; height: 300px; }
  </style>
</head>
<body>

<!-- Ù…Ù†ÙˆÛŒ Ù…Ø´ØªØ±Ú© -->
<div id="navbar-placeholder"></div>

<div class="container">
  <h1 class="text-success mb-4">ğŸ“ˆ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙØ±ÙˆØ´</h1>

  <div class="row text-center">
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>ğŸ’° Ù…Ø¬Ù…ÙˆØ¹ ÙØ±ÙˆØ´</h5>
          <h3 id="total-amount">0 ØªÙˆÙ…Ø§Ù†</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>ğŸ§¾ ØªØ¹Ø¯Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</h5>
          <h3 id="total-invoices">0</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>ğŸ“¦ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª</h5>
          <h3 id="total-products">0</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±ÙˆØ´ -->
  <div class="card">
    <div class="card-body">
      <h5 class="text-success">ğŸ“… Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±ÙˆØ´ Ø±ÙˆØ²Ø§Ù†Ù‡</h5>
      <div class="chart-container">
        <canvas id="salesChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ù„Ø§ -->
  <div class="card">
    <div class="card-body">
      <h5 class="text-success">ğŸ“¦ Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª</h5>
      <div class="chart-container">
        <canvas id="stockChart"></canvas>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  async function loadDashboard() {
    try {
      const [reportsRes, productsRes] = await Promise.all([
        fetch('https://shop-backend-dzq2.onrender.com/api/reports'),
        fetch('https://shop-backend-dzq2.onrender.com/api/products')
      ]);

      const reportsData = await reportsRes.json();
      const productsData = await productsRes.json();

      // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
      if (!reportsData.success) throw new Error("Error loading reports");

      // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ Ø¢Ù…Ø§Ø±
      document.getElementById('total-amount').textContent =
        reportsData.summary.totalAmount.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
      document.getElementById('total-invoices').textContent = reportsData.summary.totalInvoices;
      document.getElementById('total-products').textContent = productsData.length;

      // Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±ÙˆØ´ Ø±ÙˆØ²Ø§Ù†Ù‡
      const labels = reportsData.data.map(item =>
        new Date(item.date).toLocaleDateString('fa-IR')
      );
      const salesValues = reportsData.data.map(item => item.total);

      new Chart(document.getElementById('salesChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'ÙØ±ÙˆØ´ Ø±ÙˆØ²Ø§Ù†Ù‡ (ØªÙˆÙ…Ø§Ù†)',
            data: salesValues,
            borderColor: '#198754',
            backgroundColor: 'rgba(25,135,84,0.2)',
            fill: true,
            tension: 0.3
          }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });

      // Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ù„Ø§
      new Chart(document.getElementById('stockChart'), {
        type: 'bar',
        data: {
          labels: productsData.map(p => p.name),
          datasets: [{
            label: 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ',
            data: productsData.map(p => p.stock),
            backgroundColor: 'rgba(25,135,84,0.6)'
          }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });

    } catch (err) {
      console.error(err);
      alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯");
    }
  }

  document.addEventListener('DOMContentLoaded', loadDashboard);
</script>

<!-- mnu -->
<script src="assets/js/menu.js"></script>

</body>
</html>
