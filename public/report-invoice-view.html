<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§Ú©ØªÙˆØ±</title>
  <link rel="icon" href="ico/favicon.ico" type="image/x-icon">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#000000">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
  <link href="style/style.css" rel="stylesheet">
  <!-- Ø¯Ø± head -->
<link rel="stylesheet" href="assets/css/menu.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body {
      background-color: #f5f9f6;
    }
    .invoice-container {
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .invoice-header {
      border-bottom: 2px solid #28a745;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .table th {
      background-color: #e9f7ef;
    }
  </style>
</head>
<body>

  
<!-- Ø¯Ø± ØªÙ…Ø§Ù… ØµÙØ­Ø§Øª Ø¨Ø§Ù„Ø§ Ù‚Ø¨Ù„ Ø§Ø² <div class="container"> -->
<div id="navbar-placeholder"></div>

  <div class="invoice-container">
    <div class="invoice-header d-flex justify-content-between align-items-center">
      <h3 class="text-success">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§Ú©ØªÙˆØ±</h3>
      <button class="btn btn-outline-success" onclick="window.print()">
        ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª
      </button>
    </div>

    <div id="invoice-details">
      <p><strong>Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ±:</strong> <span id="inv-number">-</span></p>
      <p><strong>Ù…Ø´ØªØ±ÛŒ:</strong> <span id="inv-customer">-</span></p>
      <p><strong>ØªØ§Ø±ÛŒØ®:</strong> <span id="inv-date">-</span></p>
      <p><strong>Ù…Ø§Ù„ÛŒØ§Øª:</strong> <span id="inv-tax">-</span> ØªÙˆÙ…Ø§Ù†</p>
      <p><strong>ØªØ®ÙÛŒÙ:</strong> <span id="inv-discount">-</span> ØªÙˆÙ…Ø§Ù†</p>
      <p><strong>Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„:</strong> <span id="inv-total">-</span> ØªÙˆÙ…Ø§Ù†</p>
    </div>

    <hr>

    <h5 class="text-success mb-3">Ø§Ù‚Ù„Ø§Ù… ÙØ§Ú©ØªÙˆØ±</h5>
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Ù…Ø­ØµÙˆÙ„</th>
            <th>ØªØ¹Ø¯Ø§Ø¯</th>
            <th>Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
            <th>Ø¬Ù…Ø¹ Ú©Ù„</th>
          </tr>
        </thead>
        <tbody id="items-body">
          <tr><td colspan="5" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    async function loadInvoice() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      if (!id) return alert("Ø´Ù†Ø§Ø³Ù‡ ÙØ§Ú©ØªÙˆØ± Ù…Ø´Ø®Øµ Ù†ÛŒØ³Øª");

      try {
        const res = await fetch(`http://localhost:3000/api/invoices/${id}`);
        const data = await res.json();

        if (!res.ok || !data.invoice) {
          return alert('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§Ú©ØªÙˆØ±');
        }

        const inv = data.invoice;
        document.getElementById('inv-number').textContent = inv.invoice_no || inv.id;
        document.getElementById('inv-customer').textContent = inv.customer_name || '-';
        document.getElementById('inv-date').textContent = inv.date ? new Date(inv.date).toLocaleDateString('fa-IR') : '-';
        document.getElementById('inv-total').textContent = Number(inv.total || 0).toLocaleString('fa-IR', {maximumFractionDigits: 0});

        document.getElementById('inv-tax').textContent = Number(inv.tax || 0).toLocaleString('fa-IR', {maximumFractionDigits: 0});
        document.getElementById('inv-discount').textContent = Number(inv.discount || 0).toLocaleString('fa-IR', {maximumFractionDigits: 0});


        const tbody = document.getElementById('items-body');
        tbody.innerHTML = '';
        if (!data.items || data.items.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center">Ø¨Ø¯ÙˆÙ† Ø¢ÛŒØªÙ…</td></tr>';
          return;
        }

        data.items.forEach((it, idx) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${idx + 1}</td>
            <td>${it.product_name || '-'}</td>
            <td>${it.quantity}</td>
            <td>${Number(it.price).toLocaleString('fa-IR', {maximumFractionDigits: 0})}</td>
            <td>${(Number(it.quantity) * Number(it.price)).toLocaleString('fa-IR', {maximumFractionDigits: 0})}</td>
          `;
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error(err);
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§Ú©ØªÙˆØ±');
      }
    }

    document.addEventListener('DOMContentLoaded', loadInvoice);
  </script>

<!-- mnu -->
<script src="assets/js/menu.js"></script>

</body>
</html>
